version: 1

runtime-versions:
  nodejs: 20

frontend:
  phases:
    preBuild:
      commands:
        # Prove we’re on Node 20
        - node -v
        - corepack enable
        # Pin Yarn classic (works with yarn.lock v1). Adjust if you use Berry.
        - corepack prepare yarn@1.22.22 --activate
        - yarn -v
        # IMPORTANT: Use only ONE lockfile.
        # If package-lock.json exists, delete it from the repo, or switch to npm.
        - yarn install --frozen-lockfile || yarn install
    build:
      commands:
        # CRA treats CI=true as “fail on warnings”
        - echo "CI=false" >> $BASH_ENV && source $BASH_ENV
        - yarn build
  artifacts:
    baseDirectory: build
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
